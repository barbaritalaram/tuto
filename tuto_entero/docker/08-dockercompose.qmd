---
title: "8. Docker Compose ğŸ™"
lang: es
format: 
  html:
    page-navigation: true
    code-fold: true
---

### **Â¿QuÃ© es docker compose y para quÃ© sirve?**

Docker Compose es una herramienta que nos permite definir y manejar mÃºltiples contenedores Docker como una Ãºnica aplicaciÃ³n. En lugar de correr cada contenedor manualmente con comandos largos, puedes configurar todos tus servicios (contenedores) en un solo archivo YAML (`docker-compose.yml`) y ejecutarlos juntos con un solo comando.

---

### **Beneficios de Usar Docker Compose**

1. **Simplicidad y organizaciÃ³n:**
   - Todos los servicios estÃ¡n definidos en un Ãºnico archivo.
   - FÃ¡cil de leer y entender, especialmente en proyectos con varios contenedores.

2. **AutomatizaciÃ³n:**
   - Puedes iniciar, detener y reiniciar todos los servicios con un solo comando.
   - Define relaciones entre los servicios, como cuÃ¡l debe iniciarse primero.

3. **Consistencia:**
   - Todos los miembros del equipo utilizan la misma configuraciÃ³n.
   - No necesitas recordar largos comandos `docker run`.

4. **Compartir recursos:**
   - Los contenedores pueden compartir volÃºmenes y redes, facilitando la comunicaciÃ³n y el intercambio de datos.

---

### **Â¿Por quÃ© usar docker compose con nuestras apps?**

En nuestro caso, tenemos dos aplicaciones, `app1` y `app2`, que trabajan juntas:

1. **`app1`:**
   - Genera bromas de Chuck Norris usando una API y las guarda en un archivo `jokes.txt`.
   - Este archivo se guarda en un volumen compartido (`data`).

2. **`app2`:**
   - Lee las bromas de `jokes.txt` y las combina con imÃ¡genes de personajes de Rick and Morty.
   - Muestra todo esto en un sitio web estilo Bootstrap.

Docker Compose simplifica la forma en que estas dos aplicaciones trabajan juntas. Veamos por quÃ©:

---

### Creando el docker-compose

En el mismo directorio docker-tutorial que utilizamos la lecciÃ³n anterior, debes crear el archivo llamada `docker-compose.yml`
Asegurate que quede en el mismo nivel que estÃ¡n `app1`, `app2`, y `data`

```bash
docker-tutorial/
â”œâ”€â”€ app1/               
â”‚   â”œâ”€â”€ app.py
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”œâ”€â”€ Dockerfile
|â”€â”€ data/
â”œâ”€â”€ app2/               
â”‚   â”œâ”€â”€ app.py
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ static/
â”‚       â”œâ”€â”€ style.css
â”œâ”€â”€ docker-compose.yml
```

### Configurando el docker-compose

Abre con el editor el archivo `docker-compose.yml`, copia la configuraciÃ³n que estÃ¡ a continuaciÃ³n y pegala en el archivo:

```yml
services:
  app1:
    image: chuck_norris_generator
    build:
      context: ./app1
    environment:
      - API_URL=https://api.chucknorris.io/jokes/random
    volumes:
      - ./data:/app/data  # Monta la carpeta 'data' del host en '/app/data' en el contenedor
    restart: always

  app2:
    image: chuck_norris_web
    build:
      context: ./app2
    environment:
      - API_URL=https://rickandmortyapi.com/api/character
    ports:
      - "8081:5000"
    volumes:
      - ./data:/app/data  # Monta la carpeta 'data' del host en '/app/data' en el contenedor
    depends_on:
      - app1  # Asegura que 'app1' se inicie antes de 'app2'
    restart: always
```

### Corramos junto a docker-compose

Abre una terminal y dirigete a docker-tutorial, y ejecuta el comando `docker-compose up --build`

```bash
cd docker-turorial
docker-compose up --build
```

Si toda va bien deberÃ­as ver como se estÃ¡n iniciando los contenedores con las dos apps.

![compose](./assets/images/compose.png)

Si abres docker desktop deberÃ­as tener un contenedor llamado `docker-tutorial`y si le das click deberÃ­as ver la orquestaciÃ³n de los dos contenedores

![desktop](./assets/images/desktop.png)

Ahora si ingresas al localhost:8081 en tu navegador deberÃ­as ver la app funcionando.

![navegador compose](./assets/images/navegador%20compose.png)

### **Beneficios especÃ­ficos para este proyecto**

1. **OrquestaciÃ³n de `app1` y `app2`:**
   - Con `depends_on`, nos aseguramos de que `app1` (el generador de bromas) se inicie antes que `app2` (el visualizador de bromas e imÃ¡genes).
   - Esto evita errores de sincronizaciÃ³n.

2. **Volumen compartido (`data`):**
   - Ambos contenedores comparten el volumen `data` para leer y escribir las bromas.
   - Con docker compose, este volumen se configura fÃ¡cilmente en el archivo YAML.

3. **GestiÃ³n de Variables de Entorno:**
   - Cada app recibe la URL de su respectiva API (`Chuck Norris` para `app1` y `Rick and Morty` para `app2`) a travÃ©s de variables de entorno.

4. **Facilidad para probar y reiniciar:**
   - Si algo falla, puedes detener y reiniciar todo con:
     ```bash
     docker-compose down
     docker-compose up
     ```

5. **Compatibilidad de puertos:**
   - `app2` expone su contenido en el puerto 8081 para acceder al sitio web.

---

### **Resumiendo...**

Usar Docker Compose con **`app1`** y **`app2`** nos permite:

1. Ejecutar ambas aplicaciones juntas con un solo comando.
2. Compartir datos entre los contenedores de manera eficiente.
3. Asegurar que `app2` no intente funcionar hasta que `app1` haya comenzado a generar datos.
4. Hacer nuestro entorno mÃ¡s fÃ¡cil de manejar y reproducir.

Docker compose no solo simplifica el trabajo, sino que tambiÃ©n muestra el poder de la orquestaciÃ³n y la modularidad en proyectos Docker. ğŸš€

<a href="07-variable-volumenes.qmd" class="btn btn-primary">Anterior</a>
<a href="termino.qmd" class="btn btn-primary">Siguiente</a>